<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>日志 | Jeck_Zhang</title>
  <meta name="author" content="Jeck Zhang">
  
  <meta name="description" content="zxc&#39;s blog | java | ruby | perl | linux">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Jeck_Zhang"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link type="image/x-icon" href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Jeck_Zhang" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="/js/jquery.min.js"></script>
  
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45019001-1', 'topdna.org');
  ga('send', 'pageview');

</script>


</head>


<body>
  <!--[if lte IE 8]> <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'> <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0027_Simplified Chinese.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." style='margin-left:auto;margin-right:auto;display: block;'/></a></div> <![endif]-->
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Jeck_Zhang</a></h1>
  <h2><a href="/">Write the Code. Change the World.</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首页</a></li>
    
      <li><a href="http://weibo.com/zxc337">weibo</a></li>
    
      <li><a href="/2014/10/01/aboutMe/">关于</a></li>
    
      <li><a href="/tags/随感/">随感</a></li>
    
      <li><a href="/tags/技术/">技术</a></li>
    
      <li><a href="/tags/理财/">理财</a></li>
    
      <li><a href="/tags/生活/">生活</a></li>
    
      <li><a href="/archives">归档</a></li>
    
    <li><a href="/atom.xml">RSS</a></li>
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
<h2 class="archive-title category">日志</h2>


  
    <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2015-03-11T09:15:34.000Z"><a href="/2015/03/11/leetcode-database/">3月 11 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/03/11/leetcode-database/">LeetCode数据库题母解答</a></h1>
  

    </header>
    <div class="entry">
      
        <p>在之前做程序算法题的途中发现，LeetCode上面推出了数据库解答，有十道题，于是这两天晚上时间就给做了。解答是次要主要的好处是，正好复习复习SQL一些查询语句的写法，比如自定义变量和常用函数。题目都比较简单，少做解释，以贴题目和答案为主。</p>
<table>
<thead>
<tr>
<th><a href="https://leetcode.com/problemset/database/" target="_blank" rel="external">Title</a></th>
<th style="text-align:center"><a href="https://leetcode.com/problemset/database/" target="_blank" rel="external">Acceptance</a></th>
<th style="text-align:center"><a href="https://leetcode.com/problemset/database/" target="_blank" rel="external">Difficulty</a></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#combine-two-tables">Combine Two Tables</a></td>
<td style="text-align:center">32.5%</td>
<td style="text-align:center">Easy</td>
</tr>
<tr>
<td><a href="#second-highest-salary">Second Highest Salary</a></td>
<td style="text-align:center">23.8%</td>
<td style="text-align:center">Easy</td>
</tr>
<tr>
<td><a href="#nth-highest-salary">Nth Highest Salary</a></td>
<td style="text-align:center">14.1%</td>
<td style="text-align:center">Medium</td>
</tr>
<tr>
<td><a href="#rank-scores">Rank Scores</a></td>
<td style="text-align:center">20.7%</td>
<td style="text-align:center">Medium</td>
</tr>
<tr>
<td><a href="#consecutive-numbers">Consecutive Numbers</a></td>
<td style="text-align:center">20.2%</td>
<td style="text-align:center">Medium</td>
</tr>
<tr>
<td><a href="#employees-earning-more-than-their-managers">Employees Earning More Than Their Managers</a></td>
<td style="text-align:center">44.2%</td>
<td style="text-align:center">Easy</td>
</tr>
<tr>
<td><a href="#duplicate-emails">Duplicate Emails</a></td>
<td style="text-align:center">38.0%</td>
<td style="text-align:center">Easy</td>
</tr>
<tr>
<td><a href="#customers-who-never-order">Customers Who Never Order</a></td>
<td style="text-align:center">34.2%</td>
<td style="text-align:center">Easy</td>
</tr>
<tr>
<td><a href="#department-highest-salary">Department Highest Salary</a></td>
<td style="text-align:center">19.2%</td>
<td style="text-align:center">Medium</td>
</tr>
<tr>
<td><a href="#department-top-three-salaries">Department Top Three Salaries</a></td>
<td style="text-align:center">16.3%</td>
<td style="text-align:center">Hard</td>
</tr>
</tbody>
</table>
<h3 id="Combine_Two_Tables"><span id="combine-two-tables" style="color: #ff0000;">Combine Two Tables</span></h3>
<p>【题目】</p>
<p>Table: Person</p>
<p>+——————-+————-+<br>| Column Name | Type    |<br>+——————-+————-+<br>| PersonId    | int     |<br>| FirstName   | varchar |<br>| LastName    | varchar |<br>+——————-+————-+<br>PersonId is the primary key column for this table.<br>Table: Address</p>
<p>+——————-+————-+<br>| Column Name | Type    |<br>+——————-+————-+<br>| AddressId   | int     |<br>| PersonId    | int     |<br>| City        | varchar |<br>| State       | varchar |<br>+——————-+————-+<br>AddressId is the primary key column for this table.<br>Write a SQL query for a report that provides the following information for each person in the Person table, regardless if there is an address for each of those people:</p>
<p>FirstName, LastName, City, State<br>【解答】</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">select</span> p.FirstName, p.LastName, a.City, a.State <span class="keyword">from</span> Person p <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> Address a <span class="keyword">on</span> p.PersonId=a.PersonId;</span></div></pre></td></tr></table></figure>

<h3 id="Second_Highest_Salary"><span id="second-highest-salary" style="color: #ff0000;">Second Highest Salary</span></h3>
<p>【题目】</p>
<p>Write a SQL query to get the second highest salary from the Employee table.</p>
<p>+——+————+<br>| Id | Salary |<br>+——+————+<br>| 1  | 100    |<br>| 2  | 200    |<br>| 3  | 300    |<br>+——+————+<br>For example, given the above Employee table, the second highest salary is 200. If there is no second highest salary, then the query should return null.</p>
<p>【解答】 题目简单，但是如果和我一样，发现几个常用函数都不记得了，可以<a href="http://www.tutorialspoint.com/mysql/mysql-useful-functions.htm" target="_blank" rel="external">复习一下</a>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">select</span> <span class="keyword">IFNULL</span>( (<span class="keyword">select</span> e.Salary <span class="keyword">from</span> Employee e <span class="keyword">group</span> <span class="keyword">by</span> e.Salary <span class="keyword">order</span> <span class="keyword">by</span> e.Salary <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">1</span>, <span class="number">1</span>), <span class="literal">NULL</span>) SecondHighestSalary;</span></div></pre></td></tr></table></figure>

<h3 id="Nth_Highest_Salary"><span id="nth-highest-salary" style="color: #ff0000;">Nth Highest Salary</span></h3>
<p>【题目】</p>
<p>Write a SQL query to get the nth highest salary from the Employee table.</p>
<p>+——+————+<br>| Id | Salary |<br>+——+————+<br>| 1  | 100    |<br>| 2  | 200    |<br>| 3  | 300    |<br>+——+————+<br>For example, given the above Employee table, the nth highest salary where n = 2 is 200. If there is no nth highest salary, then the query should return null.</p>
<p>【解答】第n高，这就得用自定义变量了，平时很少用这东西，于是<a href="http://dev.mysql.com/doc/refman/5.0/en/user-variables.html" target="_blank" rel="external">复习了一下</a>先。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> getNthHighestSalary(N <span class="built_in">INT</span>) <span class="keyword">RETURNS</span> <span class="built_in">INT</span></span></div><div class="line"><span class="keyword">BEGIN</span></div><div class="line">    <span class="keyword">RETURN</span> (</div><div class="line">        <span class="keyword">select</span> <span class="keyword">IFNULL</span>(Salary, <span class="literal">NULL</span>) Salary <span class="keyword">from</span> (</div><div class="line">            <span class="keyword">select</span> @row_num := @row_num+<span class="number">1</span> Rank, Salary <span class="keyword">from</span> (</div><div class="line">                <span class="keyword">select</span> Salary <span class="keyword">from</span> Employee <span class="keyword">group</span> <span class="keyword">by</span> Salary <span class="keyword">desc</span></div><div class="line">            ) t1 <span class="keyword">join</span> (</div><div class="line">                <span class="keyword">select</span> @row_num := <span class="number">0</span> <span class="keyword">from</span> dual</div><div class="line">            ) t2</div><div class="line">        ) t <span class="keyword">where</span> t.Rank=N</div><div class="line">    );</div><div class="line"><span class="operator"><span class="keyword">END</span></span></div></pre></td></tr></table></figure>

<h3 id="Rank_Scores"><span id="rank-scores" style="color: #ff0000;">Rank Scores</span></h3>
<p>【题目】</p>
<p>Write a SQL query to rank scores. If there is a tie between two scores, both should have the same ranking. Note that after a tie, the next ranking number should be the next consecutive integer value. In other words, there should be no “holes” between ranks.</p>
<p>+——+———-+<br>| Id | Score |<br>+——+———-+<br>| 1  | 3.50  |<br>| 2  | 3.65  |<br>| 3  | 4.00  |<br>| 4  | 3.85  |<br>| 5  | 4.00  |<br>| 6  | 3.65  |<br>+——+———-+<br>For example, given the above Scores table, your query should generate the following report (order by highest score):<br>+———-+———+<br>| Score | Rank |<br>+———-+———+<br>| 4.00  | 1    |<br>| 4.00  | 1    |<br>| 3.85  | 2    |<br>| 3.65  | 3    |<br>| 3.65  | 3    |<br>| 3.50  | 4    |<br>+———-+———+<br>【解答】又是一道自定义变量的题目，这种模式应当熟悉，还是挺常见的。如果不能使用“set @var_name=0;”的话（要求用一句SQL搞定），那可以在子句里面定义“select @var_name:=0”，再在它的外面使用这个变量。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">select</span> s.Score, t.Rank <span class="keyword">from</span> (</span></div><div class="line">    <span class="keyword">select</span> @row_num:=@row_num+<span class="number">1</span> Rank, Score <span class="keyword">from</span> (</div><div class="line">         <span class="keyword">select</span> Score <span class="keyword">from</span> Scores <span class="keyword">group</span> <span class="keyword">by</span> Score <span class="keyword">desc</span></div><div class="line">    ) t1 <span class="keyword">join</span> (</div><div class="line">        <span class="keyword">select</span> @row_num := <span class="number">0</span> <span class="keyword">from</span> dual</div><div class="line">    ) t2</div><div class="line">) t, Scores s <span class="keyword">where</span> s.Score=t.Score <span class="keyword">group</span> <span class="keyword">by</span> Score <span class="keyword">desc</span>, Rank <span class="keyword">asc</span>, Id;</div></pre></td></tr></table></figure>

<h3 id="Consecutive_Numbers"><span id="consecutive-numbers" style="color: #ff0000;">Consecutive Numbers</span></h3>
<p>【题目】</p>
<p>Write a SQL query to find all numbers that appear at least three times consecutively.</p>
<p>+——+——-+<br>| Id | Num |<br>+——+——-+<br>| 1  |  1  |<br>| 2  |  1  |<br>| 3  |  1  |<br>| 4  |  2  |<br>| 5  |  1  |<br>| 6  |  2  |<br>| 7  |  2  |<br>+——+——-+<br>For example, given the above Logs table, 1 is the only number that appears consecutively for at least three times.<br>【解答】</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">select</span> <span class="keyword">DISTINCT</span>(l1.Num) <span class="keyword">from</span> <span class="keyword">Logs</span> l1, <span class="keyword">Logs</span> l2, <span class="keyword">Logs</span> l3 <span class="keyword">where</span> l1.Id+<span class="number">1</span>=l2.Id <span class="keyword">and</span> l1.Id+<span class="number">2</span>=l3.Id <span class="keyword">and</span> l1.Num=l2.Num <span class="keyword">and</span> l1.Num=l3.Num;</span></div></pre></td></tr></table></figure>

<h3 id="Employees_Earning_More_Than_Their_Managers"><span id="employees-earning-more-than-their-managers" style="color: #ff0000;">Employees Earning More Than Their Managers</span></h3>
<p>【题目】</p>
<p>The Employee table holds all employees including their managers. Every employee has an Id, and there is also a column for the manager Id.</p>
<p>+——+———-+————+—————-+<br>| Id | Name  | Salary | ManagerId |<br>+——+———-+————+—————-+<br>| 1  | Joe   | 70000  | 3         |<br>| 2  | Henry | 80000  | 4         |<br>| 3  | Sam   | 60000  | NULL      |<br>| 4  | Max   | 90000  | NULL      |<br>+——+———-+————+—————-+<br>Given the Employee table, write a SQL query that finds out employees who earn more than their managers. For the above table, Joe is the only employee who earns more than his manager.</p>
<p>+—————+<br>| Employee |<br>+—————+<br>| Joe      |<br>+—————+<br>【解答】</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">select</span> e.Name <span class="keyword">from</span> Employee e, Employee m <span class="keyword">where</span> e.ManagerId=m.Id <span class="keyword">and</span> e.Salary&gt;m.Salary;</span></div></pre></td></tr></table></figure>

<h3 id="Duplicate_Emails"><span id="duplicate-emails" style="color: #ff0000;">Duplicate Emails</span></h3>
<p>【题目】</p>
<p>Write a SQL query to find all duplicate emails in a table named Person.</p>
<p>+——+————-+<br>| Id | Email   |<br>+——+————-+<br>| 1  | a@b.com |<br>| 2  | c@d.com |<br>| 3  | a@b.com |<br>+——+————-+<br>For example, your query should return the following for the above table:</p>
<p>+————-+<br>| Email   |<br>+————-+<br>| a@b.com |<br>+————-+<br>Note: All emails are in lowercase.<br>【解答】</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">select</span> <span class="keyword">distinct</span>(p.Email) <span class="keyword">from</span> Person p, Person q <span class="keyword">where</span> p.Id!=q.Id <span class="keyword">and</span> p.Email=q.Email;</span></div></pre></td></tr></table></figure>

<h3 id="Customers_Who_Never_Order"><span id="customers-who-never-order" style="color: #ff0000;">Customers Who Never Order</span></h3>
<p>【题目】</p>
<p>Suppose that a website contains two tables, the Customers table and the Orders table. Write a SQL query to find all customers who never order anything.</p>
<p>Table: Customers.</p>
<p>+——+———-+<br>| Id | Name  |<br>+——+———-+<br>| 1  | Joe   |<br>| 2  | Henry |<br>| 3  | Sam   |<br>| 4  | Max   |<br>+——+———-+<br>Table: Orders.</p>
<p>+——+——————+<br>| Id | CustomerId |<br>+——+——————+<br>| 1  | 3          |<br>| 2  | 1          |<br>+——+——————+<br>Using the above tables as example, return the following:</p>
<p>+—————-+<br>| Customers |<br>+—————-+<br>| Henry     |<br>| Max       |<br>+—————-+<br>【解答】</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">select</span> c.Name Customers <span class="keyword">from</span> Customers c <span class="keyword">where</span> c.Id <span class="keyword">not</span> <span class="keyword">in</span> (</span></div><div class="line">    <span class="keyword">select</span> CustomerId <span class="keyword">from</span> Orders</div><div class="line">)</div></pre></td></tr></table></figure>

<h3 id="Department_Highest_Salary"><span id="department-highest-salary" style="color: #ff0000;">Department Highest Salary</span></h3>
<p>【题目】</p>
<p>The Employee table holds all employees. Every employee has an Id, a salary, and there is also a column for the department Id.</p>
<p>+——+———-+————+———————+<br>| Id | Name  | Salary | DepartmentId |<br>+——+———-+————+———————+<br>| 1  | Joe   | 70000  | 1            |<br>| 2  | Henry | 80000  | 2            |<br>| 3  | Sam   | 60000  | 2            |<br>| 4  | Max   | 90000  | 1            |<br>+——+———-+————+———————+<br>The Department table holds all departments of the company.</p>
<p>+——+—————+<br>| Id | Name     |<br>+——+—————+<br>| 1  | IT       |<br>| 2  | Sales    |<br>+——+—————+<br>Write a SQL query to find employees who have the highest salary in each of the departments. For the above tables, Max has the highest salary in the IT department and Henry has the highest salary in the Sales department.</p>
<p>+——————+—————+————+<br>| Department | Employee | Salary |<br>+——————+—————+————+<br>| IT         | Max      | 90000  |<br>| Sales      | Henry    | 80000  |<br>+——————+—————+————+<br>【解答】</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">select</span> d.Name Department, e.Name Employee, s.Salary <span class="keyword">from</span> (</span></div><div class="line">    <span class="keyword">select</span> <span class="keyword">MAX</span>(e.Salary) Salary, e.DepartmentId <span class="keyword">from</span> Employee e, Department d <span class="keyword">where</span> e.DepartmentId=d.Id <span class="keyword">group</span> <span class="keyword">by</span> e.DepartmentId</div><div class="line">) s, Employee e, Department d <span class="keyword">where</span> s.Salary=e.Salary <span class="keyword">and</span> e.DepartmentId=d.Id <span class="keyword">and</span> e.DepartmentId=s.DepartmentId;</div></pre></td></tr></table></figure>

<h3 id="Department_Top_Three_Salaries"><span id="department-top-three-salaries" style="color: #ff0000;">Department Top Three Salaries</span></h3>
<p>【题目】</p>
<p>The Employee table holds all employees. Every employee has an Id, and there is also a column for the department Id.</p>
<p>+——+———-+————+———————+<br>| Id | Name  | Salary | DepartmentId |<br>+——+———-+————+———————+<br>| 1  | Joe   | 70000  | 1            |<br>| 2  | Henry | 80000  | 2            |<br>| 3  | Sam   | 60000  | 2            |<br>| 4  | Max   | 90000  | 1            |<br>| 5  | Janet | 69000  | 1            |<br>| 6  | Randy | 85000  | 1            |<br>+——+———-+————+———————+<br>The Department table holds all departments of the company.</p>
<p>+——+—————+<br>| Id | Name     |<br>+——+—————+<br>| 1  | IT       |<br>| 2  | Sales    |<br>+——+—————+<br>Write a SQL query to find employees who earn the top three salaries in each of the department. For the above tables, your SQL query should return the following rows.</p>
<p>+——————+—————+————+<br>| Department | Employee | Salary |<br>+——————+—————+————+<br>| IT         | Max      | 90000  |<br>| IT         | Randy    | 85000  |<br>| IT         | Joe      | 70000  |<br>| Sales      | Henry    | 80000  |<br>| Sales      | Sam      | 60000  |<br>+——————+—————+————+<br>【解答】这道题拿MySql做其实是有点难了，如果我用Oracle，我就可以 rank() over(partition by xxx order by xxx desc) 这样搞了，但是MySql比较挫的地方在于没有这样分区操作的东西。不过最后还是借助了三个自定义变量搞定。意思就不解释了，还是好懂的：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">select</span> Department, Employee, Salary <span class="keyword">from</span> (</span></div><div class="line">    <span class="keyword">select</span></div><div class="line">        <span class="keyword">IF</span>(@lastDep!=t1.Department, @<span class="keyword">count</span>:=<span class="number">0</span>, @<span class="keyword">count</span>:=@<span class="keyword">count</span>), <span class="keyword">IF</span>(@lastDep=t1.Department <span class="keyword">and</span> @lastSalary!=t1.Salary, @<span class="keyword">count</span>:=@<span class="keyword">count</span>+<span class="number">1</span>, @<span class="keyword">count</span>:=@<span class="keyword">count</span>) Cnt,</div><div class="line">        @lastDep:=t1.Department, @lastSalary:=t1.Salary,</div><div class="line">        t1.Department, t1.Employee, t1.Salary</div><div class="line">    <span class="keyword">from</span> (</div><div class="line">        <span class="keyword">select</span> d.Name Department, e.Name Employee, e.Salary</div><div class="line">        <span class="keyword">from</span> Department d, Employee e <span class="keyword">where</span> d.Id=e.DepartmentId <span class="keyword">order</span> <span class="keyword">by</span> Department <span class="keyword">asc</span>, Salary <span class="keyword">desc</span></div><div class="line">    ) t1, (</div><div class="line">            <span class="keyword">select</span> @lastDep:=<span class="literal">null</span>, @lastSalary:=<span class="number">0</span>, @<span class="keyword">count</span>:=<span class="number">0</span> <span class="keyword">from</span> dual</div><div class="line">    ) t2</div><div class="line">) f <span class="keyword">where</span> Cnt&lt;<span class="number">3</span>;</div></pre></td></tr></table></figure>

<p>事后，我去看了看讨论区，发现一个漂亮的解答，没有用任何自定义变量，关键就是distinct(Salary)去和原Salary比较，过滤掉这个条件下出现次数大于3的情况：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">select</span> D.Name <span class="keyword">as</span> Department, E.Name <span class="keyword">as</span> Employee, E.Salary <span class="keyword">as</span> Salary </span></div><div class="line">  <span class="keyword">from</span> Employee E, Department D</div><div class="line">   <span class="keyword">where</span> (<span class="keyword">select</span> <span class="keyword">count</span>(<span class="keyword">distinct</span>(Salary)) <span class="keyword">from</span> Employee </div><div class="line">           <span class="keyword">where</span> DepartmentId = E.DepartmentId <span class="keyword">and</span> Salary &gt; E.Salary) <span class="keyword">in</span> (<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>)</div><div class="line">         <span class="keyword">and</span></div><div class="line">           E.DepartmentId = D.Id </div><div class="line">         <span class="keyword">order</span> <span class="keyword">by</span> E.DepartmentId, E.Salary <span class="keyword">DESC</span>;</div></pre></td></tr></table></figure>


      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






  
    <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2015-03-05T03:03:45.000Z"><a href="/2015/03/05/pingjiaapp/">3月 5 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/03/05/pingjiaapp/">关于电商商品评价评论独立第三方平台构想</a></h1>
  

    </header>
    <div class="entry">
      
        <p>现在电子商务盛行,核心是产品与服务,归根结底还是以人为本,产品和服务都是提供给消费者,得有人知晓你的这个商品,那怎么体现呢?一个是商品自身描述,另一个就是商品的评价与口碑;我想到做一个独立的第三方商品评价评论平台</p>
<h3 id="想法由来">想法由来</h3>
<p>目前中国电商混战,大型的<code>B2B</code>,<code>B2C</code>,<code>C2C</code>,<code>O2O</code>平台层出不穷,<code>垂直电商</code>领域,<code>导购</code>,<code>海淘</code>,<code>比价</code>的大平台也是多于牛毛;但是商品质量,服务质量参差不齐,刷评问题严重,监管困难,各大平台各自为阵.<br>独立的第三方评价评论平台应该出来了,在这种平台上买卖商品已经不是核心了,核心是体现商品价值,体现商品的使用价值,让更多的评价,评论把商品质量暴露出来</p>
<h3 id="项目实施">项目实施</h3>
<p>评价平台最主要的任务就是商品的标准化,涉及到各大平台具体商品的标准化,评论的整合,各个平台商品名称编码整合;</p>
<h3 id="前期实施">前期实施</h3>
<ul>
<li>丰富平台商品数量,种类</li>
<li>丰富平台商品的评论</li>
<li>平台面向用户的展现形式主要是APP,网站</li>
</ul>
<h3 id="可能出现的问题或缺陷">可能出现的问题或缺陷</h3>
<p>国外例子 <a href="http://www.dooyoo.com" target="_blank" rel="external">www.dooyoo.com</a>,<a href="http://www.ciao.com" target="_blank" rel="external">www.ciao.com</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






  
    <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2015-01-23T02:53:40.000Z"><a href="/2015/01/23/suishoupai/">1月 23 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/01/23/suishoupai/">关于随手拍图片人脸识别APP需求的想法</a></h1>
  

    </header>
    <div class="entry">
      
        <p>早上在地铁上突然想到这个需求,觉得是<code>刚需</code>,而且应用场景应该很广,大致说下我的想法:</p>
<h3 id="初级">初级</h3>
<p>能有效的识别随手拍的人脸,给出关于这个人的<code>基础信息</code>,<code>信用信息</code>,<code>社会评价</code>,<code>人品得分</code>,<code>职业信息</code>,<code>家庭信息</code>,<code>社交元素</code>,<code>系统建议</code>等等有用的实时信息;<br>当然可能识别出多个人出来,初步可以接受;<br>支持用户上传个人<code>真实信息</code>,如果信息不真实被系统识别,会降低人品得分;<br>支持手机APP上传图片,给出系统识别信息,可能来自互联网,也可能来自系统其他用户提供;</p>
<h3 id="中级">中级</h3>
<p>构建个人信用信息<code>数学模型</code>,人脸识别准确性要突破提高;<br>构建人品得分数学模型,准备预测某个人的<code>真实一面</code>;<br>增加人物评价体系,作为人品得分的<code>量化参数</code>之一;<br>评价可以匿名化;<br>基础人物信息收集;</p>
<h3 id="高级">高级</h3>
<p>构建人类基础<code>人脸信息库</code>;构建人类基础<code>信用信息库</code>;<br>构建人类基础<code>个人信息库</code>;考虑识别<code>非人类物体</code>,<code>动物</code>,<code>植物</code>,<code>商业产品</code>等;<br><code>google眼镜</code>可以是个很好地系统<code>硬件媒介</code>,拍摄人与物;</p>
<h3 id="应用场景">应用场景</h3>
<ul>
<li>交友,通过APP认识<code>陌生人</code>,认识有<code>眼缘</code>的人,认识有趣的人,通过自己的<code>第六感</code>预测值得认识这个人;</li>
<li>避免<code>黑车</code>,第六感通常不准,坐上黑车了不知道,随手拍下,看看这个是否可信;</li>
<li>识别<code>骗子</code>,让骗子无法隐藏;</li>
<li>寻找失踪儿童,迷途少年,失踪少女,失踪老人,<code>失踪人口</code>让社会更和谐;</li>
<li>通过系统的个人<code>信用信息查询</code>,识别某个人的<code>信用情况</code>;</li>
</ul>
<h3 id="可能依赖的内外部条件">可能依赖的内外部条件</h3>
<ul>
<li>图形图像识别;</li>
<li>人脸识别;</li>
<li>个人信息采集;</li>
<li>数学模型构建;</li>
<li>人肉搜索,真实信息辨别;</li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






  
    <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2015-01-02T03:04:47.000Z"><a href="/2015/01/02/linux-shell-xml/">1月 2 2015</a></time>
      
      
  
    <h1 class="title"><a href="/2015/01/02/linux-shell-xml/">Linux Shell脚本读写XML文件</a></h1>
  

    </header>
    <div class="entry">
      
        <p>在Linux下如何用<code>Shell</code>脚本读写<code>XML</code>? 现有一个config.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">config</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="title">server-ip</span>&gt;</span>192.168.0.107<span class="tag">&lt;/<span class="title">server-ip</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="title">server-port</span>&gt;</span>6379<span class="tag">&lt;/<span class="title">server-port</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="title">repository-temp-path</span>&gt;</span>/Users/zxc/workspace/redis/<span class="tag">&lt;/<span class="title">repository-temp-path</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">config</span>&gt;</span></div></pre></td></tr></table></figure>

<p>需要修改里面的<code>server-ip</code>, <code>server-port</code> 和 <code>import-path</code>,用Shell脚本的参数$1,$2,$3来写入。</p>
<p><br></p>
<h3 id="方法1:用sed命令实现">方法1:用sed命令实现</h3>
<p>首先想到的就是用sed正则匹配替换实现，写了一个shell脚本，是这样的：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="shebang">#!/bin/sh</span></div><div class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> <span class="operator">-ne</span> <span class="number">3</span> ];<span class="keyword">then</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"usage: argument 1:IP_Address 2:Server_PORT 3:Temp_PATH"</span></div><div class="line"><span class="keyword">exit</span> <span class="number">1</span></div><div class="line"><span class="keyword">fi</span></div><div class="line">IP=<span class="variable">$1</span></div><div class="line">PORT=<span class="variable">$2</span></div><div class="line">DIRT=<span class="variable">$3</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"Change values in config.xml..."</span></div><div class="line"></div><div class="line">sed <span class="string">"s/&lt;server-ip&gt;.*&lt;\/server-ip&gt;/&lt;server-ip&gt;<span class="variable">${IP}</span>&lt;\/server-ip&gt;/;s/&lt;server-port&gt;.*&lt;\/server-port&gt;/&lt;server-port&gt;<span class="variable">${PORT}</span>&lt;\/server-port&gt;/;s/&lt;repository-temp-path&gt;.*&lt;\/repository-temp-path&gt;/&lt;repository-temp-path&gt;<span class="variable">${DIRT}</span>&lt;\/repository-temp-path&gt;/"</span> config.xml &gt; config.xml</div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"Done."</span></div></pre></td></tr></table></figure>

<p>测试下来调用$ ./abc.sh 192.168.1.6 9909 \/home\/abc”是可以的，但环境变量不行，例如：$ ./abc.sh 192.168.1.6 9909 $HOME\/abc”，因为首先环境变量被解析了，所以存在反斜杠转义字符和sed替换冲突的问题。<br>用另外一个思路实现</p>
<p><br></p>
<h3 id="方法2:是直接输出该xml的内容，测试下来很管用，使用很方便，不存在反斜杠转义字符的问题和环境变量的问题：">方法2:是直接输出该xml的内容，测试下来很管用，使用很方便，不存在反斜杠转义字符的问题和环境变量的问题：</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="shebang">#!/bin/sh</span></div><div class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> <span class="operator">-ne</span> <span class="number">3</span> ];<span class="keyword">then</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"usage: argument 1:IP_Address 2:Server_PORT 3:Temp_PATH"</span></div><div class="line"><span class="keyword">exit</span> <span class="number">1</span></div><div class="line"><span class="keyword">fi</span></div><div class="line">IP=<span class="variable">$1</span></div><div class="line">PORT=<span class="variable">$2</span></div><div class="line">DIRT=<span class="variable">$3</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"Change values in config.xml..."</span></div><div class="line"></div><div class="line">cat &lt;&lt;EOF &gt;config.xml</div><div class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</div><div class="line">&lt;config&gt;</div><div class="line">   &lt;server-ip&gt;<span class="variable">${IP}</span>&lt;/server-ip&gt;</div><div class="line">   &lt;server-port&gt;<span class="variable">${PORT}</span>&lt;/server-port&gt;</div><div class="line">   &lt;repository-temp-path&gt;<span class="variable">${DIRT}</span>&lt;/repository-temp-path&gt;</div><div class="line">&lt;/config&gt;</div><div class="line">EOF  </div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"Done."</span></div></pre></td></tr></table></figure>

<p><br></p>
<h3 id="方法3：用XMLStarlet">方法3：用XMLStarlet</h3>
<p>XML + shell = XMLStarlet</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ xmlstarlet ed -u /config/server-ip -v <span class="number">192.168</span>.<span class="number">1.6</span> -u /config/server-port -v <span class="number">9909</span> -u /config/repository-temp-path -v /home/bbb input.xml</div><div class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</div><div class="line">&lt;config&gt;</div><div class="line">  &lt;server-ip&gt;<span class="number">192.168</span>.<span class="number">0.107</span>&lt;/server-ip&gt;</div><div class="line">  &lt;server-port&gt;<span class="number">6379</span>&lt;/server-port&gt;</div><div class="line">  &lt;repository-temp-path&gt;/Users/zxc/workspace/redis/&lt;/repository-temp-path&gt;</div><div class="line">&lt;/config&gt;</div></pre></td></tr></table></figure>

<p><br></p>
<h3 id="方法4：用xsltproc">方法4：用xsltproc</h3>
<p>很多Linux比如CentOS默认已安装<code>xsltproc</code>，所以用xslt可以很方便的把一个xml转换为另外一个xml。<a href="http://xmlsoft.org/XSLT/xsltproc.html" target="_blank" rel="external">具体用法</a>。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






  
    <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2014-12-12T02:50:46.000Z"><a href="/2014/12/12/oracle-tmp-tablespace/">12月 12 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/12/12/oracle-tmp-tablespace/">oracle 临时表空间扩容</a></h1>
  

    </header>
    <div class="entry">
      
        <p>临时表空间主要用途是在数据库进行排序运算、管理索引、访问视图等操作时提供临时的运算空间，当运算完成之后系统会自动清理。临时表空间不足时会影响系统性能。</p>
<h3 id="查询临时表空间">查询临时表空间</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sql&gt;select file_name,tablespace_name,bytes/1024/1024 as "total temp space(M)" from dba_temp_files;</div><div class="line">FILE_NAME                                          TABLESPACE_NAME              total temp space(M)</div><div class="line">--------------------------------------             ---------------------        -------------------</div><div class="line">/home/database/oracle/oradata/zuobian/temp01.dbf   TEMP                         512</div></pre></td></tr></table></figure>

<h3 id="查看临时表空间剩余容量">查看临时表空间剩余容量</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select tablespace_name,bytes_free/1024/1024 "free temp space(M)" from v$temp_space_header;</div><div class="line">TABLESPACE_NAME                free temp space(M)</div><div class="line">--------------------------     ------------------</div><div class="line">TEMP                           256</div></pre></td></tr></table></figure>

<h3 id="重新设定临时表空间容量">重新设定临时表空间容量</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter database tempfile '/home/database/oracle/oradata/zuobian/temp01.dbf' resize 1024M;</div><div class="line">Database altered</div></pre></td></tr></table></figure>


      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






  
    <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2014-11-27T02:57:11.000Z"><a href="/2014/11/27/spring-mvc-wizard/">11月 27 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/11/27/spring-mvc-wizard/">Spring MVC注解方式实现向导式跳转页面</a></h1>
  

    </header>
    <div class="entry">
      
        <p>近期项目需要用到向导式的跳转页面效果，本项目又是用spring mvc实现的，刚开始想到用spring的<code>webflow</code>，不过<code>webflow</code>太过笨重，对于我们不是很复杂的跳转来说好像有种“杀鸡焉用牛刀”的感觉，于是就网上搜索看有没有类似的解决方案，网上的答案一般都是叫你继承<code>AbstractWizardFormContoller</code>这个类来实现，但对于<code>spring mvc3.0.x</code>这个类将不再使用，转而推荐使用<code>注解</code>的方式来实现，于是参考<code>官方文档</code>，用注解方式实现了向导式页面。</p>
<p>下面是代码示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="annotation">@Controller</span>  </div><div class="line"><span class="annotation">@RequestMapping</span>(<span class="string">"/wizard.htm"</span>)    </div><div class="line"><span class="annotation">@SessionAttributes</span>(<span class="string">"bean"</span>)  <span class="comment">//需要保存在session中的变量</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestWizardController</span></span>{  </div><div class="line">    </div><div class="line">  <span class="annotation">@Resource</span>(name = <span class="string">"beanService"</span>)  </div><div class="line">  <span class="keyword">private</span> BeanService beanService;    </div><div class="line">    </div><div class="line">  <span class="annotation">@RequestMapping</span>  </div><div class="line">  <span class="keyword">public</span> String <span class="title">step1</span>(<span class="keyword">final</span> ModelMap modelMap){  </div><div class="line">    modelMap.addAttribute(<span class="string">"bean"</span>, <span class="keyword">new</span> Bean());  </div><div class="line">    <span class="keyword">return</span> <span class="string">"step1"</span>;  </div><div class="line">  }  </div><div class="line">    </div><div class="line">  <span class="annotation">@RequestMapping</span>(params = <span class="string">"_step=2"</span>)  </div><div class="line">  <span class="keyword">public</span> String <span class="title">step2</span>(<span class="keyword">final</span> @<span class="title">ModelAttribute</span>("bean") Bean bean,  </div><div class="line">                      <span class="keyword">final</span> Errors errors){  </div><div class="line">    <span class="keyword">return</span> <span class="string">"step2"</span>;  </div><div class="line">  }  </div><div class="line">    </div><div class="line">  <span class="annotation">@RequestMapping</span>(params = <span class="string">"_step=3"</span>)  </div><div class="line">  <span class="keyword">public</span> String <span class="title">step3</span>(<span class="keyword">final</span> @<span class="title">ModelAttribute</span>("bean") Bean bean,  </div><div class="line">                      <span class="keyword">final</span> Errors errors){  </div><div class="line">    <span class="keyword">return</span> <span class="string">"step3"</span>;  </div><div class="line">  }  </div><div class="line">    </div><div class="line">  <span class="annotation">@RequestMapping</span>(params = <span class="string">"_finish"</span>)  </div><div class="line">  <span class="keyword">public</span> String <span class="title">processFinish</span>(@<span class="title">ModelAttribute</span>("bean")Bean bean,  </div><div class="line">                              <span class="keyword">final</span> Errors errors,  </div><div class="line">                              <span class="keyword">final</span> ModelMap modelMap,  </div><div class="line">                              <span class="keyword">final</span> SessionStatus status){  </div><div class="line">  </div><div class="line">    beanService.add(bean);     </div><div class="line">    status.setComplete();  </div><div class="line">    <span class="keyword">return</span> <span class="string">"success"</span>;  </div><div class="line">  }  </div><div class="line">    </div><div class="line">  <span class="annotation">@RequestMapping</span>(params = <span class="string">"_cancel"</span>)  </div><div class="line">  <span class="keyword">public</span> String <span class="title">processCancel</span>(<span class="keyword">final</span> HttpServletRequest request,  </div><div class="line">                              <span class="keyword">final</span> HttpServletResponse response,  </div><div class="line">                              <span class="keyword">final</span> SessionStatus status){  </div><div class="line">     status.setComplete();  </div><div class="line">     <span class="keyword">return</span> <span class="string">"cancel"</span>;  </div><div class="line">  }  </div><div class="line">      </div><div class="line">}</div></pre></td></tr></table></figure>

<p>其中起到最大作用的就是<code>@SessionAttributes</code>这个注解，它定义了一个在<code>session</code>范围内的变量，这个变量可以在不同的页面跳转时保持状态。</p>
<p>第一次访问 <a href="http://www.example.com/wizard.htm" target="_blank" rel="external">http://www.example.com/wizard.htm</a> 时进入step1方法，其后提交的表单action后面都要加上相应的参数，如：</p>
<p>step1页面 </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">"http://www.example.com/wizard.htm?_step=2"</span>&gt;</span></div></pre></td></tr></table></figure>

<p>step2页面 </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">"http://www.example.com/wizard.htm?_step=3"</span>&gt;</span></div></pre></td></tr></table></figure>

<p>step3页面 </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">"http://www.example.com/wizard.htm?_finish"</span>&gt;</span></div></pre></td></tr></table></figure>


      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






  
    <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2014-11-26T08:03:16.000Z"><a href="/2014/11/26/spring-mvc-xss/">11月 26 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/11/26/spring-mvc-xss/">Spring MVC里面xss攻击的预防</a></h1>
  

    </header>
    <div class="entry">
      
        <p>关于xss的介绍可以看 <a href="http://www.cnblogs.com/luminji/archive/2012/05/22/2507185.html" target="_blank" rel="external">Asp.net安全架构之1：xss（跨站脚本）</a>和 <a href="http://www.cnblogs.com/kingthy/archive/2011/08/20/2147355.html" target="_blank" rel="external">腾讯微博的XSS攻击漏洞</a> 网页，</p>
<p>具体我就讲讲Spring MVC里面的预防：</p>
<h3 id="第一种方法,使用Spring_MVC">第一种方法,使用Spring MVC</h3>
<p>web.xml加上：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">context-param</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="title">param-name</span>&gt;</span>defaultHtmlEscape<span class="tag">&lt;/<span class="title">param-name</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="title">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="title">param-value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">context-param</span>&gt;</span></div></pre></td></tr></table></figure>

<p>Forms加上：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">spring:htmlEscape</span> <span class="attribute">defaultHtmlEscape</span>=<span class="value">"true"</span> /&gt;</span></div></pre></td></tr></table></figure>


<p>更多信息查看<a href="https://www.owasp.org/index.php/Main_Page" target="_blank" rel="external">OWASP</a>的<a href="https://www.owasp.org/index.php/XSS_%28Cross_Site_Scripting%29_Prevention_Cheat_Sheet" target="_blank" rel="external">页面</a></p>
<p><br></p>
<h3 id="第二种方法是手动escape">第二种方法是手动escape</h3>
<p>例如用户可以输入：</p>
<figure class="highlight javaScript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;script&gt;alert();<span class="xml"><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span></div></pre></td></tr></table></figure>

<p>或者输入</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">h2</span>&gt;</span>abc<span class="tag">&lt;<span class="title">h2</span>&gt;</span></div></pre></td></tr></table></figure>

<p>,如果有异常,显然有xss漏洞。<br>首先添加一个jar包:<code>commons-lang-2.5.jar</code>,然后在后台调用这些函数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">StringEscapeUtils.escapeHtml(string); </div><div class="line">StringEscapeUtils.escapeJavaScript(string); </div><div class="line">StringEscapeUtils.escapeSql(string);</div></pre></td></tr></table></figure>

<p>前台js调用escape函数即可。</p>
<p><br></p>
<h3 id="第三种方法是后台加Filter,对每个post请求的参数过滤一些关键字,替换成安全的">第三种方法是后台加Filter,对每个post请求的参数过滤一些关键字,替换成安全的</h3>
<p>例如：&lt; &gt; ‘ “ \ /  # &amp;<br>方法是实现一个自定义的<code>HttpServletRequestWrapper</code>，然后在Filter里面调用它，替换掉getParameter函数即可。<br>首先添加一个<code>XssHttpServletRequestWrapper</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.ibm.web.beans;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.Enumeration;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequestWrapper;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XssHttpServletRequestWrapper</span> <span class="keyword">extends</span> <span class="title">HttpServletRequestWrapper</span> </span>{  </div><div class="line">    <span class="keyword">public</span> <span class="title">XssHttpServletRequestWrapper</span>(HttpServletRequest servletRequest) {</div><div class="line">        <span class="keyword">super</span>(servletRequest);</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> String[] <span class="title">getParameterValues</span>(String parameter) {</div><div class="line">      String[] values = <span class="keyword">super</span>.getParameterValues(parameter);</div><div class="line">      <span class="keyword">if</span> (values==<span class="keyword">null</span>)  {</div><div class="line">                  <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">          }</div><div class="line">      <span class="keyword">int</span> count = values.length;</div><div class="line">      String[] encodedValues = <span class="keyword">new</span> String[count];</div><div class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) {</div><div class="line">                 encodedValues[i] = cleanXSS(values[i]);</div><div class="line">       }</div><div class="line">      <span class="keyword">return</span> encodedValues;</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> String <span class="title">getParameter</span>(String parameter) {</div><div class="line">          String value = <span class="keyword">super</span>.getParameter(parameter);</div><div class="line">          <span class="keyword">if</span> (value == <span class="keyword">null</span>) {</div><div class="line">                 <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">                  }</div><div class="line">          <span class="keyword">return</span> cleanXSS(value);</div><div class="line">    }</div><div class="line">    <span class="keyword">public</span> String <span class="title">getHeader</span>(String name) {</div><div class="line">        String value = <span class="keyword">super</span>.getHeader(name);</div><div class="line">        <span class="keyword">if</span> (value == <span class="keyword">null</span>)</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">return</span> cleanXSS(value);</div><div class="line">    }</div><div class="line">    <span class="keyword">private</span> String <span class="title">cleanXSS</span>(String value) {</div><div class="line">                <span class="comment">//You'll need to remove the spaces from the html entities below</span></div><div class="line">        value = value.replaceAll(<span class="string">"&lt;"</span>, <span class="string">"& lt;"</span>).replaceAll(<span class="string">"&gt;"</span>, <span class="string">"& gt;"</span>);</div><div class="line">        value = value.replaceAll(<span class="string">"\\("</span>, <span class="string">"& #40;"</span>).replaceAll(<span class="string">"\\)"</span>, <span class="string">"& #41;"</span>);</div><div class="line">        value = value.replaceAll(<span class="string">"'"</span>, <span class="string">"& #39;"</span>);</div><div class="line">        value = value.replaceAll(<span class="string">"eval\\((.*)\\)"</span>, <span class="string">""</span>);</div><div class="line">        value = value.replaceAll(<span class="string">"[\\\"\\\'][\\s]*javascript:(.*)[\\\"\\\']"</span>, <span class="string">"\"\""</span>);</div><div class="line">        value = value.replaceAll(<span class="string">"script"</span>, <span class="string">""</span>);</div><div class="line">        <span class="keyword">return</span> value;</div><div class="line">    }</div><div class="line"></div><div class="line">}</div></pre></td></tr></table></figure>

<p>然后添加一个过滤器XssFilter ：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.ibm.web.beans;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;  </div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.servlet.Filter;  </div><div class="line"><span class="keyword">import</span> javax.servlet.FilterChain;  </div><div class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;  </div><div class="line"><span class="keyword">import</span> javax.servlet.ServletException;  </div><div class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;  </div><div class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;  </div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;  </div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XssFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>{</div><div class="line">    FilterConfig filterConfig = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span>(FilterConfig filterConfig) <span class="keyword">throws</span> ServletException {</div><div class="line">        <span class="keyword">this</span>.filterConfig = filterConfig;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span>() {</div><div class="line">        <span class="keyword">this</span>.filterConfig = <span class="keyword">null</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span>(ServletRequest request, ServletResponse response,</div><div class="line">            FilterChain chain) <span class="keyword">throws</span> IOException, ServletException {</div><div class="line">        chain.doFilter(<span class="keyword">new</span> XssHttpServletRequestWrapper(</div><div class="line">                (HttpServletRequest) request), response);</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>最后在web.xml里面配置一下，所有的请求的getParameter会被替换，如果参数里面含有<code>敏感词</code>会被替换掉：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">filter</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="title">filter-name</span>&gt;</span>XssSqlFilter<span class="tag">&lt;/<span class="title">filter-name</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="title">filter-class</span>&gt;</span>com.ibm.web.beans.XssFilter<span class="tag">&lt;/<span class="title">filter-class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">filter</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">filter-mapping</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="title">filter-name</span>&gt;</span>XssSqlFilter<span class="tag">&lt;/<span class="title">filter-name</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="title">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="title">url-pattern</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="title">dispatcher</span>&gt;</span>REQUEST<span class="tag">&lt;/<span class="title">dispatcher</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="title">filter-mapping</span>&gt;</span></div></pre></td></tr></table></figure>

<p> (这个Filter也可以防止SQL注入攻击) </p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






  
    <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2014-11-25T03:01:27.000Z"><a href="/2014/11/25/xushen/">11月 25 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/11/25/xushen/">徐神的诗</a></h1>
  

    </header>
    <div class="entry">
      
        <p><br></p>
<p><img src="/img/ma.jpg"></p>
<p><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;今早在群里看到徐架构的两个代码片段,惊呼徐架构的造诣之高,见解之深,手法之妙,特此写下读后感,以作勉励!下面我以整体局部再整体的方式剖析下徐神的诗.<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这首诗是我迄今为止看到徐架构,最最精华的一首;首先诗的架构精妙绝伦,设计思想超乎寻常,层次分明,语句工整,言简意赅,段落堆叠有致,是后现代主义的代表作;注解手法的运用,让我们看到此首诗只应天上有,人间那得几回闻;单词,命名,语法丝毫不差,处处透露着徐神的高超技艺.<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;细节之处的把握也是毫厘必究,字字斟酌.类的命名典型的驼峰式,代表着徐神心思缜密;方法的注释详细,用词准确,也流露出徐神对代码重构抽象的考究;注解类中方法的个数,每个方法的参数格式,无不体现徐神设计思想博大精深;方法默认值的给出,让我们这些墨守成规的人,立马顿悟,此处应有掌声;四个方法每一个都是那么的重要,那么的抽象,那么的活灵活现,仿佛是有生命的精灵,作用不同,协同调用,发挥着强大的思想感召力;提示信息不可少,徐神的设计可谓匠心独用,精益求精;再聚焦下类名,方法名,用形容词而不用动词,见文识意,生动灵活,不经让我感叹,天下之大,山外有山,人外有人,徐神正是山外山,人外人;数组也是徐神必备的利器,在这里用到了,而且是恰到好处,妙笔生花,令人望洋兴叹,却又意犹未尽;基础数据类型在徐神眼里,也是兴头上的事,信手拈来,毫无顾忌,挥洒自如,在这里我看到了徐神对编程的理解,对架构的领悟,对技术人生的参透,真是入木三分哇;组合思想的使用,再一次证明了他是徐神,此处省略一万词,我此刻激动之情已经无以言表,只可意会;还有一个细节,没错,徐神用到字符串,也是点睛之笔;段落末尾,那惊人的分号,苍劲有力,是徐神情感的爆发,对当代社会的批判,对行业不公的蔑视,对代码人生的宣泄;徐神的代码是艺术的升华,是情感的迸发,是思想的解脱.<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;整首诗字字珠玑,优雅而曼妙;每一个字母都不少也都不多,甚至连空格都是那么的弥足珍贵;徐神在他成千上万的代码块中,独独选择了这两首,用心良苦,展示了徐神对安全的重视,徐神这种工匠精神也给同行业从业者敲响了警钟;在徐神看来是其貌不扬的两首诗,在我看来却是精华之笔,实属无价之宝;读完徐神的诗,如同醍醐灌顶一般,久久还在脑中回荡,真是酣畅淋漓,受益匪浅.看到这里,我想结束自己散漫不羁,碌碌无为的生活,徐神是个无法逾越的神话,闲暇的时间我愿追随徐神,学习,进取,奋发.<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;整首诗抑扬顿挫,婉约细腻;即便是放到寻常百姓家,也丝毫不觉得违和;可见徐神功底之深,已臻化境,此等炉火纯青的架构经验,已非常人努力四十余年可匹敌;短短几十余字,徐神从架构,设计,编程思想,算法,效率,安全各个技术领域,全面阐述其编程之道,架构之魂;徐神对各种技术无不精通,无不涉猎,给当代码农竖起了一座丰碑.<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;古往今来,横贯中外,执代码之牛耳,唯徐神一人矣!致天下之治者在人才,成天下之才者在教化,我当以徐神为师,学而不倦.<br></p>


      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






  
    <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2014-11-12T04:19:34.000Z"><a href="/2014/11/12/ibatis1/">11月 12 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/11/12/ibatis1/">ibatis中传参$与#区别以及对List的排序</a></h1>
  

    </header>
    <div class="entry">
      
        <p>开发中ibatis会用到： $ 和 # 符号。</p>
<p>一、区别</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$aaa$ 输出参数是以字符串方式直接输出 123</div><div class="line"></div><div class="line">#aaa# 输出参数是以Parameter方式输出 @aaa</div></pre></td></tr></table></figure>

<p>二、实例</p>
<p>SQL :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;select id="selectMetaMandao"  parameterClass="java.util.HashMap" resultMap="WaasmetaMandaoMap" &gt;  </div><div class="line">    SELECT $subCategory$ rchannel,sum(mandao) mandao from</div><div class="line">    ( SELECT nvl(channel,'-') channel,ROUND(count(1)*0.1131) mandao  FROM WAAS_VIEW_USER_RESULT a </div><div class="line">    AND not EXISTS (</div><div class="line">    SELECT msgid</div><div class="line">      FROM DT_XMS_MT b</div><div class="line">     WHERE EXISTS</div><div class="line">           (SELECT MSGID FROM WAAS_VIEW_USER_RESULT WHERE STATUS = 'SUCCESS' AND msgid = b.msgid)</div><div class="line">    AND msgid = a.msgid)</div><div class="line">       GROUP BY channel) d LEFT JOIN waas_channel_summary c ON d.channel = c.original_channel </div><div class="line">    &lt;isNotEmpty property="channel"&gt;</div><div class="line">            WHERE c.original_channel LIKE '%'||#channel#||'%' </div><div class="line">     &lt;/isNotEmpty&gt;</div><div class="line">       GROUP BY $subCategory$</div><div class="line">&lt;/select&gt;</div></pre></td></tr></table></figure>

<p>代码 :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="annotation">@RequestMapping</span>(<span class="string">"queryMeta"</span>)</div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">selectMeta</span>(HttpServletRequest request, HttpServletResponse response) {</div><div class="line">    String channel = request.getParameter(<span class="string">"channel"</span>);</div><div class="line">    Map&lt;String, Object&gt; param = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</div><div class="line">    <span class="comment">//以参数方式输出, 相当于一个变量 (活的)</span></div><div class="line">    param.put(<span class="string">"channel"</span>, channel); </div><div class="line">    <span class="comment">//以字符串方式输出, 直接输出(死的)</span></div><div class="line">    param.put(<span class="string">"subCategory"</span>, channel == <span class="keyword">null</span> ? <span class="string">"primary_category"</span> : <span class="string">"ORIGINAL_CHANNEL"</span>); </div><div class="line">    List&lt;WAASUserMOTypeResult&gt; data = wumtService.selectMeta(param);</div><div class="line">    <span class="comment">//因为楼上这个List查完之后重新封装的, 所以无序, 要对List里面的对象进行排序, 如下</span></div><div class="line">    Collections.sort(data, <span class="keyword">new</span> Comparator&lt;WAASUserMOTypeResult&gt;() {</div><div class="line">        <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span>(WAASUserMOTypeResult o1, WAASUserMOTypeResult o2) {</div><div class="line">            <span class="keyword">return</span> o2.getShijia() - o1.getShijia(); <span class="comment">//排序字段, 倒序</span></div><div class="line">        }</div><div class="line">    });</div><div class="line">	</div><div class="line">    ......</div><div class="line">	</div><div class="line">    renderJson(response, resultJson.toString());</div><div class="line">}</div></pre></td></tr></table></figure>

<p>实现效果:</p>
<p>如果传channel参数, 则根据原始媒体(ORIGINAL_CHANNEL)分组, 不传则根据合并后的大媒体(primary_category) 分组.</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






  
    <article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2014-11-10T08:50:10.000Z"><a href="/2014/11/10/my-java-dev-tools/">11月 10 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/11/10/my-java-dev-tools/">我的Java程序员开发常用工具集</a></h1>
  

    </header>
    <div class="entry">
      
        <p>我发现很多人没办法高效地解决问题的关键原因是不熟悉工具，不熟悉工具也还罢了，甚至还不知道怎么去找工具，这个问题就大条了。我想列下我能想到的一个Java程序员会用到的常用工具。</p>
<p>一、编码工具</p>
<p> 1.IDE：<a href="http://www.eclipse.org/" target="_blank" rel="external">Eclipse</a>或者<a href="http://www.jetbrains.com/idea/" target="_blank" rel="external">IDEA</a>，熟悉尽可能多的快捷键，《<a href="https://www.google.com/#hl=zh-CN&amp;site=&amp;source=hp&amp;q=Eclipse+%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE&amp;oq=Eclipse+%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE&amp;aq=f&amp;aqi=g-l1&amp;aql=&amp;gs_l=hp.3..0i13.449l7739l0l7948l53l49l9l4l4l9l278l4511l14j15j7l36l0.&amp;bav=on.2,or.r_gc.r_pw.r_cp.,cf.osb&amp;fp=eef1a08d3fa904e4&amp;biw=1594&amp;bih=858" target="_blank" rel="external">Eclipse常见快捷键列表</a>》</p>
<p> 2.插件：<br> (1) <a href="http://findbugs.sourceforge.net/" target="_blank" rel="external">Findbugs</a>，在release之前进行一次静态代码检查是必须的<br> (2) <a href="http://www.atlassian.com/software/clover/overview" target="_blank" rel="external">Clover</a>，关心你的单元测试覆盖率<br> (3) <a href="http://checkstyle.sourceforge.net/" target="_blank" rel="external">Checkstyle</a> 代码风格检查</p>
<p> 3.构建和部署工具:ant或者maven，现在主流都是maven了吧，使用<a href="http://www.sonatype.org/nexus/" target="_blank" rel="external">nexus搭建maven私服</a>，再加上持续集成<a href="http://jenkins-ci.org/" target="_blank" rel="external">jenkins</a>。代码质量不用愁。</p>
<p> 4.版本管理工具： svn或者git</p>
<p> 5.<a href="http://www.linuxsky.org/doc/admin/200712/213.html" target="_blank" rel="external">diff</a>和<a href="http://www.linuxsky.org/doc/admin/200712/213.html" target="_blank" rel="external">patch</a></p>
<p> 6.设置你的eclipse或者IDEA，如formatter,save actions以及code template等。代码风格，直接用google的也可以啊。《<a href="http://code.google.com/p/google-styleguide/" target="_blank" rel="external">Google style guide</a>》</p>
<p> 7.掌握一个文本编辑器，Emacs或者VIM，熟悉常用快捷键。这在你需要在线编辑代码，或者编写其他语言代码时候特别有用。《<a href="http://linuxtoy.org/archives/why-emacs-vim-good.html" target="_blank" rel="external">神器圣战</a>》</p>
<p>二、JDK相关</p>
<p>1.jstat : 观察GC情况，如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jstat -gcutil pid <span class="number">3078</span></div></pre></td></tr></table></figure>

<p>2.jmap，查看heap情况，如查看存活对象列表：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jmap -histo:live pid |grep com.company |less</div></pre></td></tr></table></figure>

<p>或者dump内存用来分析：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jmap -dump:file=test.bin pid</div></pre></td></tr></table></figure>

<p>3.分析dump的堆文件，可以用jhat:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jhat test.bin</div></pre></td></tr></table></figure>

<p>  分析完成后可以用浏览器查看堆的情况。这个工具的分析结果还比较原始，你还可以用Eclipse MAT插件进行图形化分析，或者IBM的<a href="https://www.ibm.com/developerworks/community/groups/service/html/communityview?communityUuid=4544bafe-c7a2-455f-9d43-eb866ea60091" target="_blank" rel="external">Heap Analyzer</a>.</p>
<p>4.jvisualvm和jconsole： JVM自带的性能分析和监控工具，怎么用？请自己看<a href="http://docs.oracle.com/javase/6/docs/technotes/guides/visualvm/index.html" target="_blank" rel="external">文档</a>。</p>
<p>5.jstack：分析线程堆栈，如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jstack pid &gt; thread_dump</div></pre></td></tr></table></figure>

<p>查看CPU最高的线程在干什么的方法结合top和jstack：<a href="http://www.iteye.com/topic/1114219" target="_blank" rel="external">http://www.iteye.com/topic/1114219</a></p>
<p>6.更多JVM工具，参见官方文档：<a href="http://docs.oracle.com/javase/6/docs/technotes/tools/" target="_blank" rel="external">http://docs.oracle.com/javase/6/docs/technotes/tools/</a></p>
<p>7.学习使用btrace分析java运行时问题。《(Btrace使用简介)[<a href="http://rdc.taobao.com/team/jm/archives/509]》" target="_blank" rel="external">http://rdc.taobao.com/team/jm/archives/509]》</a></p>
<p>8.GC日志分析工具：GC viewer、GC-console或者自己挑<a href="http://stackoverflow.com/questions/1839599/analyze-gc-logs-for-sun-hotspots-jvm-6" target="_blank" rel="external">这里</a>。</p>
<p>9.性能分析工具，除了自带的jvisualvm外，还可以用商业的jprofiler。</p>
<p>10.<a href="http://kenwublog.com/docs/java6-jvm-options-chinese-edition.htm" target="_blank" rel="external">JVM参数大全</a></p>
<p>11.《<a href="http://hllvm.group.iteye.com/group/topic/27945" target="_blank" rel="external">JVM调优标准参数陷阱</a>》，iteye神贴。</p>
<p>三、Linux工具</p>
<p>1.熟悉<a href="http://www.commandlinefu.com/commands/browse/sort-by-votes" target="_blank" rel="external">常用的shell命令</a>，</p>
<p>2.设置<a href="http://paulkeck.com/ssh/" target="_blank" rel="external">ssh免登陆</a></p>
<p>3.使用htop替换top。</p>
<p>4.熟悉下strace,gdb甚至systemtap来分析问题。</p>
<p>5.熟悉vmstat,iostat,sar等性能统计工具。</p>
<p>5.自动化部署脚本，<a href="http://docs.fabfile.org/en/1.4.1/index.html" target="_blank" rel="external">py-fabric</a>或者自荐下这个<a href="https://github.com/killme2008/clojure-control" target="_blank" rel="external">clojure-control</a>。</p>
<p>四、其他</p>
<p>1.掌握一门脚本语言，<a href="http://python.org/" target="_blank" rel="external">Python</a>或者<a href="http://www.ruby-lang.org/" target="_blank" rel="external">Ruby</a>，高效解决一些需要quick and dirty的任务：比如读写文件、导入导出数据库、网页爬虫等。注意不是python.com，咔咔。</p>
<p><code>Python</code>推荐<a href="http://woodpecker.org.cn/" target="_blank" rel="external">啄木鸟社区</a>,<code>Ruby</code>推荐<a href="https://ruby-china.org/" target="_blank" rel="external">Ruby China</a></p>
<p>2.使用Linux或者Mac os系统作为你的开发环境。</p>
<p>3.升级你的“硬件工具”，双屏大屏显示器、SSD、8G内存甚至更多。</p>
<p>4.你懂的：<a href="https://code.google.com/p/goagent/" target="_blank" rel="external">https://code.google.com/p/goagent/</a> ; <a href="https://github.com/justjavac/Google-IPs/blob/master/README.md" target="_blank" rel="external">https://github.com/justjavac/Google-IPs/blob/master/README.md</a></p>
<p>五、如何查找工具？</p>
<p>1.搜索引擎，google或者baidu，《<a href="http://www.williamlong.info/archives/728.html" target="_blank" rel="external">搜索技巧</a>》</p>
<p>2.万能的stack overflow：<a href="http://stackoverflow.com/" target="_blank" rel="external">http://stackoverflow.com/</a></p>
<p>3.虚心问牛人。</p>
<p>六、最重要的是⋯⋯</p>
<p>一颗永不停止学习的心。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






  

  <ul class="page-direction" id="page-direction">
    <li><a class="page-prev icon-chevron-sign-left" href="javascript:;" title="上一页"></a></li>
    <li><a class="page-next icon-chevron-sign-right" href="javascript:;" title="下一页"></a></li>
</ul>

    <nav id="page-list" class="page-list"><span class="page-number current">1</span><a class="page-number" href="/categories/日志/page/2/">2</a><a class="page-number" href="/categories/日志/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/categories/日志/page/5/">5</a><a class="extend next" rel="next" href="/categories/日志/page/2/">Next</a></nav>

<nav id="pagination">
  
  
    <a href="/categories/日志/page/2/" class="alignright next">下一页</a>
  
  <div class="clearfix"></div>
</nav>
</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="text" name="q" results="0" placeholder="搜一下">
    <i class="icon-search"></i>
    <input type="hidden" name="q" value="site:lawrence-zxc.github.io">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/Git/">Git</a><small>2</small></li>
  
    <li><a href="/tags/Java/">Java</a><small>18</small></li>
  
    <li><a href="/tags/JavaScript/">JavaScript</a><small>4</small></li>
  
    <li><a href="/tags/LeetCode/">LeetCode</a><small>2</small></li>
  
    <li><a href="/tags/Linux/">Linux</a><small>10</small></li>
  
    <li><a href="/tags/Mac-Unix/">Mac/Unix</a><small>1</small></li>
  
    <li><a href="/tags/Mongodb/">Mongodb</a><small>1</small></li>
  
    <li><a href="/tags/Mysql/">Mysql</a><small>3</small></li>
  
    <li><a href="/tags/Nginx/">Nginx</a><small>5</small></li>
  
    <li><a href="/tags/Oracle/">Oracle</a><small>5</small></li>
  
    <li><a href="/tags/Python/">Python</a><small>3</small></li>
  
    <li><a href="/tags/XMPP/">XMPP</a><small>1</small></li>
  
    <li><a href="/tags/其他/">其他</a><small>1</small></li>
  
    <li><a href="/tags/前端/">前端</a><small>1</small></li>
  
    <li><a href="/tags/开始/">开始</a><small>4</small></li>
  
    <li><a href="/tags/技术/">技术</a><small>2</small></li>
  
    <li><a href="/tags/旅行/">旅行</a><small>1</small></li>
  
    <li><a href="/tags/架构/">架构</a><small>2</small></li>
  
    <li><a href="/tags/理财/">理财</a><small>1</small></li>
  
    <li><a href="/tags/生活/">生活</a><small>1</small></li>
  
    <li><a href="/tags/读书/">读书</a><small>1</small></li>
  
    <li><a href="/tags/随感/">随感</a><small>4</small></li>
  
  </ul>
</div>


  <div class="trace-invest">
    <span>
        <a href="https://github.com/Lawrence-zxc" target="_blank">欢迎光临我的技术Blog网站 </br>Fork me on Github</a>
    </span>
</div>


  
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2015/03/11/leetcode-database/">LeetCode数据库题母解答</a>
      </li>
    
      <li>
        <a href="/2015/03/05/pingjiaapp/">关于电商商品评价评论独立第三方平台构想</a>
      </li>
    
      <li>
        <a href="/2015/01/23/suishoupai/">关于随手拍图片人脸识别APP需求的想法</a>
      </li>
    
      <li>
        <a href="/2015/01/02/linux-shell-xml/">Linux Shell脚本读写XML文件</a>
      </li>
    
      <li>
        <a href="/2014/12/12/oracle-tmp-tablespace/">oracle 临时表空间扩容</a>
      </li>
    
      <li>
        <a href="/2014/11/27/spring-mvc-wizard/">Spring MVC注解方式实现向导式跳转页面</a>
      </li>
    
      <li>
        <a href="/2014/11/26/spring-mvc-xss/">Spring MVC里面xss攻击的预防</a>
      </li>
    
      <li>
        <a href="/2014/11/25/xushen/">徐神的诗</a>
      </li>
    
      <li>
        <a href="/2014/11/20/openfire/">Openfire服务端错误解决</a>
      </li>
    
      <li>
        <a href="/2014/11/12/ibatis1/">ibatis中传参$与#区别以及对List的排序</a>
      </li>
    
      <li>
        <a href="/2014/11/10/my-java-dev-tools/">我的Java程序员开发常用工具集</a>
      </li>
    
      <li>
        <a href="/2014/11/10/oracle-index/">Oracle大批量高效地更新大数据表索引字段</a>
      </li>
    
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <div id="go-pg-top"><i class="icon-arrow-up"></i></div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2015 Jeck Zhang
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/page.js"></script>


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?a5eb19e532c0b101d72226b1325e6a78";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</body>

</html>